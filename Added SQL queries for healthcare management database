-- How many patients are registered in the system?
SELECT COUNT(patientID) as total_patients
FROM patients;

--List all patients older than 30 years.
Select * from patients
where datediff(year,dob,getdate())>30;

/**Retrieve the contact information (name, phone, address) of patients
 who have appointments in the next 7 days**/
 
 Select p.firstname,
 p.lastname,
 p.phone,
 p.address
 from patients as P
 INNER JOIN Appointments as A 
 ON P.patientid=A.patientid
 where cast (a.appointmentdate as date)between 
 cast (getdate() as date)and cast (dateadd(day,7,getdate()) as date);

--Find the total number of male and female patients in the database.
select count (case when gender ='male' then 1 end ) as male_pt,
    count(case when gender ='female' then 1 end ) as female_pt
	from patients;

-- List all doctors and their specialties.
select firstname,lastname,specialty
from doctors;

--Find the doctor with the highest number of appointments.
select d.firstname, d.lastname,d.specialty
from doctors as d inner join 
(select top 1 doctorid, count(appointmentid) as appointment_count
from appointments 
group by doctorid
order by  appointment_count desc)
as top_doc
on d.doctorid=top_doc.doctorid;

--Show a count of doctors by their specialties

select count(doctorid) as doctor_count,
specialty from doctors
group by specialty
order by doctor_count;

-- List all appointments scheduled for today
select * from appointments
where cast (appointmentdate as date) = cast( getdate() as date);

--Find the next available appointment for a specific doctor.

select top 1 d.firstname,d.lastname,a.appointmentdate
from appointments as a
 join doctors as d
on a.doctorid=d.doctorid
 where appointmentdate > getdate()
order by appointmentdate asc;

--List appointments for a particular patient, sorted by date.

select p.firstname,
    p.lastname 
from patients as p
left join appointments as a
on p.patientid=a.patientid
where p.patientid= 1
and appointmentdate between '2023-01-01' and getdate()
order by appointmentdate;

--Retrieve all appointments that were missed 
select * from appointments 
where status = 'missed';


--Show the total amount billed to each patient
select sum(totalamount) as patient_bills,
    patientid 
from billing
group by patientid 
order by patient_bills desc;


-- List patients who have outstanding balances

select p.firstname,
    p.lastname,
   sum(b.totalamount) as outstanding_balances
from 
   billing as b
left join 
  patients as p
on 
  b.patientid=p.patientid
where
  b.paymentstatus = 'pending'
group by
  p.firstname,
  p.lastname
order by 
   outstanding_balances desc;

-- Find the total revenue generated by the hospital for a given month.
select sum(totalamount) 
  as total_revenue
from billing 
where billingdate between '2023-09-01' and '2023-09-30'

--Find the most common reasons for appointments

select top 3 m.diagnosis,
count(a.appointmentid) as highest_num_appointment
from appointments as a
join MedicalRecords as m
on a.patientid=m.patientid
group by m.diagnosis
order by highest_num_appointment desc;


-- List the busiest days of the week for appointments
select DATENAME(weekday,appointmentdate)
     as busiest_days,
count(*) 
     as total_appointments
from appointments
group by DATENAME(weekday,appointmentdate),
        datepart (weekday,appointmentdate)
order by total_appointments desc;

-- Update a patientâ€™s contact information
update patients
set 
address ='344 vicky street',
phone= '123-555-8651'
where
patientid=1

--Insert a new patient and schedule an initial appointment for them with a doctor.
INSERT INTO Patients (FirstName, LastName, Gender, DOB, Phone, Address, City, Country, EmergencyContact)
VALUES 
('victoria', 'Doe', 'feMale', '1988-05-12', '123-456-7891', '123 aww Street', 'New York', 'USA', 'pete Doe, 123-456-7893')

INSERT INTO Appointments (PatientID, DoctorID, AppointmentDate, AppointmentTime, Status, Notes)
VALUES 
(11, 1, '2024-12-23', '09:00', 'Scheduled', 'Routine checkup')


